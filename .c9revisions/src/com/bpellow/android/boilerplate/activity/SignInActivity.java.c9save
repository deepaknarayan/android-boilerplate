{"ts":1352387504329,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"package com.bpellow.android.boilerplate.activity;\n\nimport android.content.Context;\nimport android.os.AsyncTask;\nimport android.os.Bundle;\nimport android.view.View;\nimport android.widget.Button;\nimport android.widget.EditText;\n\nimport com.bpellow.android.boilerplate.R;\nimport com.bpellow.android.boilerplate.activity.model.Token;\nimport com.bpellow.android.boilerplate.net.ApiProxyStub;\nimport com.bpellow.android.boilerplate.util.Preferences;\n\npublic class SignInActivity extends BaseActivity {\n\tprivate EditText inputUsername;\n\tprivate EditText inputPassword;\n\tprivate Button signinBtn;\n\t\n\tprivate LoginTask loginTask;\n\t\n    /** Called when the activity is first created. */\n    @Override\n    public void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.sign_in);\n        \n        initialize();\n    }\n    \n    public void initialize() {\n    \tsuper.initialize();\n    \tinputUsername = (EditText)findViewById(R.id.username);\n    \tinputPassword = (EditText)findViewById(R.id.password);\n    \tsigninBtn = (Button)findViewById(R.id.sign_in_btn);\n    \tshowKeyboard(inputUsername);\n    \t\n    \tsigninBtn.setOnClickListener(new View.OnClickListener() {\n\t\t\t@Override\n\t\t\tpublic void onClick(View arg0) {\n\t\t\t\tif (inputUsername.getText().length() > 0 && inputPassword.getText().length() > 0) {\n\t\t\t\t\tattemptSuccessfulLogin();\n\t\t\t\t} else {\n\t\t\t\t\t// error, please enter a username and password dialog\n\t\t\t\t\tshowDialog(DIALOG_ENTER_UNAME_AND_PASS);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n    }\n    \n    public void attemptSuccessfulLogin() {\n    \tif (loginTask == null) {\n\t\t\tloginTask = new LoginTask();\n\t\t\tloginTask.execute(self);\n\t\t}\n    }\n    \n    /**\n     * sub-class of AsyncTask\n     */\n    protected class LoginTask extends AsyncTask<Context, Integer, Boolean> {\n    \tString username;\n    \tString password;\n    \tToken auth_token;\n    \t\n    \t@Override\n    \tprotected void onPreExecute() {\n    \t\tsuper.onPreExecute();\n\t\t\tusername = inputUsername.getText().toString();\n\t\t\tpassword = inputPassword.getText().toString();\n\t\t\tshowDialog(DIALOG_SIGN_IN);\n    \t}\n\n\t\t@Override\n\t\tprotected Boolean doInBackground(Context... arg0) {\n\t\t\ttry {\n    \t\tToken auth_token = ApiProxyStub.getAuthToken(username, password, null);\n    \t\tif (auth_token != null && auth_token.getAuthToken() != null) {\n    \t\t\tPreferences.put(self, Preferences.AUTH_TOKEN, auth_token.getAuthToken());\n    \t\t\tPreferences.put(self, Preferences.USERNAME, username);\n    \t\t\tPreferences.put(self, Preferences.PASSWORD, password);\n    \t\t\treturn true;\n    \t\t}\n\t\t\t} catch (Exception e) {\n\t\t\t\te.printStackTrace();\n\t\t\t\tshowDialog(self.DIALOG_ERROR_NETWORK);\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\t\t\n\t\t@Override\n\t\tprotected void onPostExecute(Boolean result) {\n\t\t\tsuper.onPostExecute(result);\n\t\t\tdismissDialog(DIALOG_SIGN_IN);\n\t\t\tif (result) {\n\t\t\t\t// goto deal page\n\t\t\t\tself.goToActivity(MenuActivity.class, true);\n\t\t\t} else {\n\t\t\t\tloginTask = null;\n\t\t\t}\n\t\t}\n    }\n}"]],"start1":0,"start2":0,"length1":0,"length2":2930}]],"length":2930}
